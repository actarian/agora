/**
 * @license agora v1.0.0
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("rxcomp"),require("rxcomp-form"),require("rxjs/operators"),require("rxjs")):"function"==typeof define&&define.amd?define(["rxcomp","rxcomp-form","rxjs/operators","rxjs"],t):t((e=e||self).rxcomp,e.rxcomp.form,e.rxjs.operators,e.rxjs)}(this,(function(e,t,n,o){"use strict";function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var r=function(){function e(){this.onStreamPublished=this.onStreamPublished.bind(this),this.onStreamAdded=this.onStreamAdded.bind(this),this.onStreamSubscribed=this.onStreamSubscribed.bind(this),this.onStreamRemoved=this.onStreamRemoved.bind(this),this.onPeerLeaved=this.onPeerLeaved.bind(this),this.onTokenPrivilegeWillExpire=this.onTokenPrivilegeWillExpire.bind(this),this.onTokenPrivilegeDidExpire=this.onTokenPrivilegeDidExpire.bind(this)}var t=e.prototype;return t.connect=function(){var e=this;this.createClient((function(){e.joinChannel()}))},t.onError=function(e){console.log("Agora",e)},t.onStreamPublished=function(e){console.log("Publish local stream successfully")},t.onStreamAdded=function(e){var t=this.client,n=e.stream,o=n.getId();console.log("New stream added: "+o),o!==this.uid&&t.subscribe(n,(function(e){console.log("stream subscribe failed",e)}))},t.onStreamSubscribed=function(e){var t=e.stream,n=t.getId();console.log("Subscribe remote stream successfully: "+n);var o=document.querySelector(".video-other");o&&(o.setAttribute("id","agora_remote_"+n),o.classList.add("playing")),t.play("agora_remote_"+n)},t.onStreamRemoved=function(e){var t=e.stream,n=t.getId();if(console.log("stream-removed remote-uid: ",n),n!==this.uid){t.stop("agora_remote_"+n);var o=document.querySelector(".video-other");o&&o.classList.remove("playing")}console.log("stream-removed remote-uid: ",n)},t.onPeerLeaved=function(e){var t=e.uid;if(console.log("peer-leave id",t),t!==this.uid){var n=document.querySelector(".video-other");n&&n.classList.remove("playing")}},t.onTokenPrivilegeWillExpire=function(e){console.log("onTokenPrivilegeWillExpire")},t.onTokenPrivilegeDidExpire=function(e){console.log("onTokenPrivilegeDidExpire")},t.createClient=function(e){console.log("agora sdk version: "+AgoraRTC.VERSION+" compatible: "+AgoraRTC.checkSystemRequirements());var t=this.client=AgoraRTC.createClient({mode:"live",codec:"h264"});t.init("ab4289a46cd34da6a61fd8d66774b65f",(function(){console.log("AgoraRTC client initialized"),e()}),(function(e){console.log("AgoraRTC client init failed",e)})),t.on("stream-published",this.onStreamPublished),t.on("stream-added",this.onStreamAdded),t.on("stream-subscribed",this.onStreamSubscribed),t.on("error",this.onError),t.on("peer-leave",this.onPeerLeaved),t.on("stream-removed",this.onStreamRemoved),t.on("onTokenPrivilegeWillExpire",this.onTokenPrivilegeWillExpire),t.on("onTokenPrivilegeDidExpire",this.onTokenPrivilegeDidExpire)},t.joinChannel=function(){var e=this;this.client.join(null,"Channel",null,(function(t){console.log("User "+t+" join channel successfully"),e.detectDevices((function(n){console.log(n),n.videos.length&&n.audios.length&&e.createLocalStream(t,n.audios[0].deviceId,n.videos[0].deviceId)}))}),(function(e){console.log("Join channel failed",e)}))},t.detectDevices=function(e){AgoraRTC.getDevices((function(t){t.filter((function(e){return-1!==["audioinput","videoinput"].indexOf(e.kind)})).map((function(e){return{label:e.label,deviceId:e.deviceId,kind:e.kind}}));for(var n=[],o=[],i=0;i<t.length;i++){var r=t[i];"videoinput"==r.kind&&n.push({label:r.label||"camera-"+n.length,deviceId:r.deviceId,kind:r.kind}),"audioinput"==r.kind&&o.push({label:r.label||"microphone-"+n.length,deviceId:r.deviceId,kind:r.kind})}e({videos:n,audios:o})}))},t.createLocalStream=function(e,t,n){this.local=AgoraRTC.createStream({streamID:e,audio:!0,video:!0,screen:!1,microphoneId:t,cameraId:n});this.initLocalStream()},t.initLocalStream=function(){var e=this,t=(this.client,this.local);t.init((function(){console.log("getUserMedia successfully");var n=document.querySelector(".video-me");n&&(n.setAttribute("id","agora_local_"+t.streamID),t.play("agora_local_"+t.streamID)),e.publishLocalStream()}),(function(e){console.log("getUserMedia failed",e)}))},t.publishLocalStream=function(){var e=this.client,t=this.local;e.publish(t,(function(e){console.log("Publish local stream error: "+e)}))},t.unpublishLocalStream=function(){var e=this.client,t=this.local;e.unpublish(t,(function(e){console.log("unpublish failed")}))},t.leaveChannel=function(){client.leave((function(){console.log("Leave channel successfully")}),(function(e){console.log("Leave channel failed")}))},e}(),s="41999"===window.location.port||"actarian.github.io"===window.location.host,a=(["localhost","127.0.0.1","0.0.0.0"].indexOf(window.location.host.split(":")[0]),function(){function e(){}return e.get=function(e){return new URLSearchParams(window.location.search).get(e)},e.set=function(e,t){var n=new URLSearchParams(window.location.search);"string"==typeof e?n.set(e,t):n.set(e,""),this.replace(n)},e.replace=function(e){if(window.history&&window.history.pushState){var t=document.title,n=window.location.href.split("?")[0]+"?"+e.toString();window.history.pushState(e.toString(),t,n)}},e.deserialize=function(e){var t=this.get("params");return this.decode(e,t)},e.serialize=function(e,t){var n=this.deserialize(),o=this.encode(e,t,n);this.set("params",o)},e.decode=function(e,t){var n=null;if(t){var o=window.atob(t);n=JSON.parse(o)}return e&&n&&(n=n[e]),n||null},e.encode=function(e,t,n){n=n||{};"string"==typeof e?n[e]=t:n=e;var o=JSON.stringify(n);return window.btoa(o)},e}()),c=function(e){this.data=e},u=function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),t}(c),l=function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),t}(c),d=function(){function e(){}return e.open$=function(e){var t=this;return this.getTemplate$(e.src).pipe(n.map((function(n){return{node:t.getNode(n),data:e.data,modal:e}})),n.tap((function(e){return t.modal$.next(e)})),n.switchMap((function(e){return t.events$})))},e.load$=function(e){},e.getTemplate$=function(e){return o.from(fetch(e).then((function(e){return e.text()})))},e.getNode=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},e.reject=function(e){this.modal$.next(null),this.events$.next(new l(e))},e.resolve=function(e){this.modal$.next(null),this.events$.next(new u(e))},e}();d.modal$=new o.Subject,d.events$=new o.Subject;var p=function(){function e(){}return e.http$=function(e,t,i,r){var s=this;void 0===r&&(r="json");var a=null;return o.from(fetch(this.getUrl(t,r),{method:e,headers:{Accept:"application/json","Content-Type":"application/json"},body:-1!==["POST","PUT","PATCH"].indexOf(e)?JSON.stringify(i):void 0}).then((function(e){return a=e,e.ok?e[r]():e.json().then((function(e){return Promise.reject(e)}))}))).pipe(n.catchError((function(e){return o.throwError(s.getError(e,a))})))},e.get$=function(e,t,n){var o=this.query(t);return this.http$("GET",""+e+o,void 0,n)},e.delete$=function(e){return this.http$("DELETE",e)},e.post$=function(e,t){return this.http$("POST",e,t)},e.put$=function(e,t){return this.http$("PUT",e,t)},e.patch$=function(e,t){return this.http$("PATCH",e,t)},e.query=function(e){return""},e.getUrl=function(e,t){return void 0===t&&(t="json"),s&&"json"===t&&0===e.indexOf("/")?"."+e+".json":e},e.getError=function(e,t){var n="object"==typeof e?e:{};return n.statusCode||(n.statusCode=t?t.status:0),n.statusMessage||(n.statusMessage=t?t.statusText:e),console.log("HttpService.getError",n,e),n},e}(),h=function(){function e(){}return e.delete=function(e){this.isLocalStorageSupported()&&window.localStorage.removeItem(e)},e.exist=function(e){if(this.isLocalStorageSupported())return void 0!==window.localStorage[e]},e.get=function(e){var t=null;if(this.isLocalStorageSupported()&&void 0!==window.localStorage[e])try{t=JSON.parse(window.localStorage[e])}catch(t){console.log("LocalStorageService.get.error parsing",e,t)}return t},e.set=function(e,t){if(this.isLocalStorageSupported())try{var n=[],o=JSON.stringify(t,(function(e,t){if("object"==typeof t&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t}));window.localStorage.setItem(e,o)}catch(n){console.log("LocalStorageService.set.error serializing",e,t,n)}},e.isLocalStorageSupported=function(){if(this.supported)return!0;var e=!1;try{(e="localStorage"in window&&null!==window.localStorage)?(window.localStorage.setItem("test","1"),window.localStorage.removeItem("test")):e=!1}catch(t){e=!1}return this.supported=e,e},e}(),f=function(){function e(){}return e.setUser=function(e){this.user$.next(e)},e.me$=function(){var e=this;return p.get$("/api/users/me").pipe(n.map((function(t){return e.mapStatic__(t,"me")})),n.switchMap((function(t){return e.setUser(t),e.user$})))},e.register$=function(e){var t=this;return p.post$("/api/users/register",e).pipe(n.map((function(e){return t.mapStatic__(e,"register")})))},e.update=function(e){var t=this;return p.post$("/api/users/updateprofile",e).pipe(n.map((function(e){return t.mapStatic__(e,"register")})))},e.login$=function(e){var t=this;return p.post$("/api/users/login",e).pipe(n.map((function(e){return t.mapStatic__(e,"login")})))},e.logout$=function(){var e=this;return p.post$("/api/users/logout").pipe(n.map((function(t){return e.mapStatic__(t,"logout")})))},e.retrieve$=function(e){var t=this;return p.post$("/api/users/retrievepassword",e).pipe(n.map((function(e){return t.mapStatic__(e,"retrieve")})))},e.mapStatic__=function(e,t){if(void 0===t&&(t="me"),!s)return e;switch(t){case"me":h.exist("user")||(e=null);break;case"register":case"login":h.set("user",e);break;case"logout":h.delete("user")}return e},e}();f.user$=new o.BehaviorSubject(null);var g=s?"/agora/club-modal.html":"/Viewdoc.cshtml?co_id=23649",m=function(t){function o(){return t.apply(this,arguments)||this}i(o,t);var s=o.prototype;return s.onInit=function(){e.getContext(this).node.classList.remove("hidden"),(new r).connect()},s.onDropped=function(e){console.log("AppComponent.onDropped",e)},s.parseQueryString=function(){switch(a.get("action")){case"login":this.openLogin();break;case"register":this.openRegister()}},s.openLogin=function(){this.openLoginRegisterModal(1)},s.openRegister=function(){this.openLoginRegisterModal(2)},s.openLoginRegisterModal=function(e){void 0===e&&(e=1),d.open$({src:g,data:{view:e}}).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){e instanceof u&&f.setUser(e.data)}))},o}(e.Component);m.meta={selector:"[app-component]"};var v=function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),t}(e.Module);v.meta={imports:[e.CoreModule,t.FormModule],declarations:[],bootstrap:m},e.Browser.bootstrap(v)}));
//# sourceMappingURL=main.min.js.map