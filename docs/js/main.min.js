/**
 * @license agora v1.0.0
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("rxcomp"),require("rxcomp-form"),require("rxjs/operators"),require("rxjs")):"function"==typeof define&&define.amd?define(["rxcomp","rxcomp-form","rxjs/operators","rxjs"],t):t((e=e||self).rxcomp,e.rxcomp.form,e.rxjs.operators,e.rxjs)}(this,(function(e,t,o,n){"use strict";function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var r="41999"===window.location.port||"actarian.github.io"===window.location.host,s=(["localhost","127.0.0.1","0.0.0.0"].indexOf(window.location.host.split(":")[0]),function(){function e(){}return e.get=function(e){return new URLSearchParams(window.location.search).get(e)},e.set=function(e,t){var o=new URLSearchParams(window.location.search);"string"==typeof e?o.set(e,t):o.set(e,""),this.replace(o)},e.replace=function(e){if(window.history&&window.history.pushState){var t=document.title,o=window.location.href.split("?")[0]+"?"+e.toString();window.history.pushState(e.toString(),t,o)}},e.deserialize=function(e){var t=this.get("params");return this.decode(e,t)},e.serialize=function(e,t){var o=this.deserialize(),n=this.encode(e,t,o);this.set("params",n)},e.decode=function(e,t){var o=null;if(t){var n=window.atob(t);o=JSON.parse(n)}return e&&o&&(o=o[e]),o||null},e.encode=function(e,t,o){o=o||{};"string"==typeof e?o[e]=t:o=e;var n=JSON.stringify(o);return window.btoa(n)},e}()),a=function(e){this.data=e},c=function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),t}(a),u=function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),t}(a),l=function(){function e(){}return e.open$=function(e){var t=this;return this.getTemplate$(e.src).pipe(o.map((function(o){return{node:t.getNode(o),data:e.data,modal:e}})),o.tap((function(e){return t.modal$.next(e)})),o.switchMap((function(e){return t.events$})))},e.load$=function(e){},e.getTemplate$=function(e){return n.from(fetch(e).then((function(e){return e.text()})))},e.getNode=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},e.reject=function(e){this.modal$.next(null),this.events$.next(new u(e))},e.resolve=function(e){this.modal$.next(null),this.events$.next(new c(e))},e}();l.modal$=new n.Subject,l.events$=new n.Subject;var d=function(){function e(){}return e.http$=function(e,t,i,r){var s=this;void 0===r&&(r="json");var a=null;return n.from(fetch(this.getUrl(t,r),{method:e,headers:{Accept:"application/json","Content-Type":"application/json"},body:-1!==["POST","PUT","PATCH"].indexOf(e)?JSON.stringify(i):void 0}).then((function(e){return a=e,e.ok?e[r]():e.json().then((function(e){return Promise.reject(e)}))}))).pipe(o.catchError((function(e){return n.throwError(s.getError(e,a))})))},e.get$=function(e,t,o){var n=this.query(t);return this.http$("GET",""+e+n,void 0,o)},e.delete$=function(e){return this.http$("DELETE",e)},e.post$=function(e,t){return this.http$("POST",e,t)},e.put$=function(e,t){return this.http$("PUT",e,t)},e.patch$=function(e,t){return this.http$("PATCH",e,t)},e.query=function(e){return""},e.getUrl=function(e,t){return void 0===t&&(t="json"),r&&"json"===t&&0===e.indexOf("/")?"."+e+".json":e},e.getError=function(e,t){var o="object"==typeof e?e:{};return o.statusCode||(o.statusCode=t?t.status:0),o.statusMessage||(o.statusMessage=t?t.statusText:e),console.log("HttpService.getError",o,e),o},e}(),p=function(){function e(){}return e.delete=function(e){this.isLocalStorageSupported()&&window.localStorage.removeItem(e)},e.exist=function(e){if(this.isLocalStorageSupported())return void 0!==window.localStorage[e]},e.get=function(e){var t=null;if(this.isLocalStorageSupported()&&void 0!==window.localStorage[e])try{t=JSON.parse(window.localStorage[e])}catch(t){console.log("LocalStorageService.get.error parsing",e,t)}return t},e.set=function(e,t){if(this.isLocalStorageSupported())try{var o=[],n=JSON.stringify(t,(function(e,t){if("object"==typeof t&&null!==t){if(-1!==o.indexOf(t))return;o.push(t)}return t}));window.localStorage.setItem(e,n)}catch(o){console.log("LocalStorageService.set.error serializing",e,t,o)}},e.isLocalStorageSupported=function(){if(this.supported)return!0;var e=!1;try{(e="localStorage"in window&&null!==window.localStorage)?(window.localStorage.setItem("test","1"),window.localStorage.removeItem("test")):e=!1}catch(t){e=!1}return this.supported=e,e},e}(),f=function(){function e(){}return e.setUser=function(e){this.user$.next(e)},e.me$=function(){var e=this;return d.get$("/api/users/me").pipe(o.map((function(t){return e.mapStatic__(t,"me")})),o.switchMap((function(t){return e.setUser(t),e.user$})))},e.register$=function(e){var t=this;return d.post$("/api/users/register",e).pipe(o.map((function(e){return t.mapStatic__(e,"register")})))},e.update=function(e){var t=this;return d.post$("/api/users/updateprofile",e).pipe(o.map((function(e){return t.mapStatic__(e,"register")})))},e.login$=function(e){var t=this;return d.post$("/api/users/login",e).pipe(o.map((function(e){return t.mapStatic__(e,"login")})))},e.logout$=function(){var e=this;return d.post$("/api/users/logout").pipe(o.map((function(t){return e.mapStatic__(t,"logout")})))},e.retrieve$=function(e){var t=this;return d.post$("/api/users/retrievepassword",e).pipe(o.map((function(e){return t.mapStatic__(e,"retrieve")})))},e.mapStatic__=function(e,t){if(void 0===t&&(t="me"),!r)return e;switch(t){case"me":p.exist("user")||(e=null);break;case"register":case"login":p.set("user",e);break;case"logout":p.delete("user")}return e},e}();f.user$=new n.BehaviorSubject(null);var h=r?"/agora/club-modal.html":"/Viewdoc.cshtml?co_id=23649",g=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var r=n.prototype;return r.onInit=function(){var t=this;e.getContext(this).node.classList.remove("hidden"),f.user$.pipe(o.takeUntil(this.unsubscribe$)).subscribe((function(e){console.log("AppComponent.user$",e),t.user=e,t.pushChanges()})),setTimeout((function(){t.parseQueryString()}),500),this.createClient((function(){t.joinChannel()}))},r.createClient=function(e){console.log("agora sdk version: "+AgoraRTC.VERSION+" compatible: "+AgoraRTC.checkSystemRequirements());var t=this.client=AgoraRTC.createClient({mode:"live",codec:"h264"});t.init("ab4289a46cd34da6a61fd8d66774b65f",(function(){console.log("AgoraRTC client initialized"),e()}),(function(e){console.log("AgoraRTC client init failed",e)})),t.on("stream-published",(function(e){console.log("Publish local stream successfully")})),t.on("stream-added",(function(e){var o=e.stream,n=o.getId();console.log("New stream added: "+n),n!==this.uid&&t.subscribe(o,(function(e){console.log("stream subscribe failed",e)}))})),t.on("stream-subscribed",(function(e){var t=e.stream,o=t.getId();console.log("Subscribe remote stream successfully: "+o);var n=document.querySelector(".video-other");n&&(n.setAttribute("id","agora_remote_"+o),n.classList.add("playing")),console.log("video",n),t.play("agora_remote_"+o)})),t.on("error",(function(e){console.log("Agora",e)})),t.on("peer-leave",(function(e){var t=e.uid;if(console.log("peer-leave id",t),t!==this.uid){var o=document.querySelector(".video-other");o&&o.classList.remove("playing")}})),t.on("stream-removed",(function(e){var t=e.stream,o=t.getId();if(console.log("stream-removed remote-uid: ",o),o!==this.uid){t.stop("agora_remote_"+o);var n=document.querySelector(".video-other");n&&n.classList.remove("playing")}console.log("stream-removed remote-uid: ",o)})),t.on("onTokenPrivilegeWillExpire",(function(){console.log("onTokenPrivilegeWillExpire")})),t.on("onTokenPrivilegeDidExpire",(function(){console.log("onTokenPrivilegeDidExpire")}))},r.joinChannel=function(){var e=this;this.client.join(null,"Channel",null,(function(t){console.log("User "+t+" join channel successfully"),e.detectDevices((function(o){console.log(o),o.videos.length&&o.audios.length&&e.publishVideo(t,o.audios[0].deviceId,o.videos[0].deviceId)}))}),(function(e){console.log("Join channel failed",e)}))},r.detectDevices=function(e){AgoraRTC.getDevices((function(t){t.filter((function(e){return-1!==["audioinput","videoinput"].indexOf(e.kind)})).map((function(e){return{label:e.label,deviceId:e.deviceId,kind:e.kind}}));for(var o=[],n=[],i=0;i<t.length;i++){var r=t[i];"videoinput"==r.kind&&o.push({label:r.label||"camera-"+o.length,deviceId:r.deviceId,kind:r.kind}),"audioinput"==r.kind&&n.push({label:r.label||"microphone-"+o.length,deviceId:r.deviceId,kind:r.kind})}e({videos:o,audios:n})}))},r.publishVideo=function(e,t,o){var n=this.client,i=AgoraRTC.createStream({streamID:e,audio:!0,video:!0,screen:!1,microphoneId:t,cameraId:o});i.init((function(){console.log("getUserMedia successfully");var t=document.querySelector(".video-me");t&&(t.setAttribute("id","agora_local_"+e),i.play("agora_local_"+e)),n.publish(i,(function(e){console.log("Publish local stream error: "+e)}))}),(function(e){console.log("getUserMedia failed",e)})),this.local=i},r.unpublishVideo=function(){var e=this.client,t=this.local;e.unpublish(t,(function(e){console.log("unpublish failed")}))},r.leaveChannel=function(){client.leave((function(){console.log("Leave channel successfully")}),(function(e){console.log("Leave channel failed")}))},r.onDropped=function(e){console.log("AppComponent.onDropped",e)},r.parseQueryString=function(){switch(s.get("action")){case"login":this.openLogin();break;case"register":this.openRegister()}},r.openLogin=function(){this.openLoginRegisterModal(1)},r.openRegister=function(){this.openLoginRegisterModal(2)},r.openLoginRegisterModal=function(e){void 0===e&&(e=1),l.open$({src:h,data:{view:e}}).pipe(o.takeUntil(this.unsubscribe$)).subscribe((function(e){e instanceof c&&f.setUser(e.data)}))},n}(e.Component);g.meta={selector:"[app-component]"};var m=function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),t}(e.Module);m.meta={imports:[e.CoreModule,t.FormModule],declarations:[],bootstrap:g},e.Browser.bootstrap(m)}));
//# sourceMappingURL=main.min.js.map